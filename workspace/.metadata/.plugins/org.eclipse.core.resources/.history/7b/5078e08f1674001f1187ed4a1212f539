package StudentService;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
	import java.util.Scanner;
	import StudentDAO.Student;
	import StudentDAO.Databaseconnections;
	public class StudentServiceImpl implements StudentService
	{
		
		/*
		 * ArrayList<Student> obj=new ArrayList<Student>();
		 * 
		 * @Override public void studentaccadamindetails() {
		 * System.out.println(String.format(
		 * "%-8s%-8s%-8s%-8s%-8s%-8s%-8s%-8s%-8s%-8s%-8s","Id ","  Name","Tamili marks"
		 * ,"English marks","Maths marks","Science marks","Social marks","Total",
		 * "Average","Classification","Eligibility")); //System.out.println(obj);
		 * if(!obj.isEmpty()) { for(Student str:obj) {
		 * //System.out.println("StdentId:"+str.getId()+"    ""+str.getName()+"
		 * "+str.getTamil()+" "+str.getEnglish()+" "+str.getMaths()+"
		 * "+str.getScience()+" "+str.getSocial()+" "+str.getTotal()+"
		 * "+str.getAverage()+" "+str.getClassification()+" "+str.getEligibility());
		 * System.out.println(String.format(
		 * "%-8s%-8s%-8s%-8s%-8s%-8s%-8s%-8s%-8s%-8s%-8s,",str.getId(),str.getName(),str
		 * .getTamil(),str.getEnglish(),str.getMaths(),str.getScience(),str.getSocial(),
		 * str.getTotal(),str.getAverage(),str.getClassification(),str.getEligibility())
		 * );
		 * 
		 * } }
		 * 
		 * }
		 */

		/*
		 * @Override public void studentpersonaldetails() {
		 * System.out.println("======Student PersonalDetails=======");
		 * System.out.println("Name   Address "); if(!obj.isEmpty()) { for(Student
		 * str:obj) { System.out.println(str.getName()); } } }
		 */

		@Override
		public Student studentregistration() 
		{
			Scanner sc=new Scanner(System.in);
			Student obj1=new Student();
			/**/
			System.out.println("Enter student Id:");
			obj1.setId(sc.nextInt());
			sc.nextLine();
			System.out.println("Enter the student Name:");
			obj1.setName(sc.nextLine());
			
			/*
			 * System.out.println("Enter the student Address:"); sc.next();
			 */
			//obj1.setAddress(sc.nextLine());
			System.out.println("Enter Tamil marks:");
			obj1.setTamil(sc.nextInt());
			System.out.println("Enter English marks:");
			obj1.setEnglish(sc.nextInt());
			System.out.println("Enter Maths marks:");
			obj1.setMaths(sc.nextInt());
			System.out.println("Enter Science marks:");
			obj1.setScience(sc.nextInt());
			System.out.println("Enter Social marks:");
			obj1.setSocial(sc.nextInt());
			//obj.add(obj1);
			obj1.setTotal(getTotal(obj1.getTamil(),obj1.getEnglish(),obj1.getMaths(),obj1.getScience(),obj1.getSocial()));
			//obj.add(obj1);
			obj1.setAverage(getAverage((obj1.getTamil()),obj1.getEnglish(),obj1.getMaths(),obj1.getScience(),obj1.getSocial()));
			//obj.add(obj1);
			obj1.setClassification(getClassification(obj1.getAverage()));
			//obj.add(obj1);
			obj1.setEligibility(getEligibility(obj1.getMaths(),obj1.getScience(),obj1.getSocial()));
			
					sc.close();
					insertPerson(obj1);
			return obj1;
		
		}
		

		public float  getAverage(int tamil,int english,int maths,int science,int social)
		{
			float avg = (tamil+english+maths+science+social)/5;
			return avg;
		
		}
		public String getClassification(float avg) 
		{

			String classification;
			if(avg>=75)
	 		{
				classification= "Distiction";
	 		}
	 		else if(avg>=60)
	 		{
	 			classification= "Firstclass";
	 		}
	 		else if(avg>=50)
	 		{
	 			classification= "secondclass";
	 			
	 		}
	 		else
	 		{
	 			classification="Thirdclass";
	 		}
			return classification; 
		}
			
		
		public String getEligibility(int maths,int science,int social)
		{
			boolean cutoff=maths+science>=180;
			boolean cutoff1=science+social>130;
			if(cutoff&&cutoff1)
			{
				return "Engineering and Arts colleges";
			}
			else if(cutoff1)
			{
				return "Eligible for Engineering only";
			}
			return "Eligible for Arts only";
			//return null;
			
		}
		public int getTotal(int tamil,int english,int maths,int science,int social)
		{
			int total = tamil+english+maths+science+social;
			return total;
		}
		
		
		
		
		public void insertPerson(Student obj1) 
		{
			Databaseconnections db=new Databaseconnections();
	        String sql = "INSERT INTO studentinformation (id,name,tamilmarks,englishmarks,mathsmarks,sciencemarks,socialmarks,average,total,classification,eligibility) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
	        //String sql="Select *from studentinformation";
			System.out.println("connection established successfully");
				try (
						 Connection conn = db.getConnection();
			             PreparedStatement pstmt = conn.prepareStatement(sql);)
			            		 
				{
					
						pstmt.setInt(1, obj1.getId());
			            pstmt.setString(2, obj1.getName());
			            pstmt.setInt(3, obj1.getTamil());
			            pstmt.setInt(4, obj1.getEnglish());
			            pstmt.setInt(5, obj1.getMaths());
			            pstmt.setInt(6, obj1.getScience());
			            pstmt.setInt(7, obj1.getSocial());
			            pstmt.setFloat(8, obj1.getAverage());
			            pstmt.setInt(9, obj1.getTotal());
			            pstmt.setString(10, obj1.getClassification());
			            pstmt.setString(11, obj1.getEligibility());
			            int rowsAffected = pstmt.executeUpdate();
			            System.out.println("Rows inserted in database: " + rowsAffected);
			            System.out.println("check in data base");
			            conn.close();
			            pstmt.close();
					}
				
				catch (SQLException e)
				{
			            e.printStackTrace();
			        }
	}
					public void getstudentdetailsindatabase(int id)
				{
					Databaseconnections db=new Databaseconnections();
			        String sql="Select *from studentinformation where id=?";
					System.out.println("connection established successfully");
					System.out.println("Getting information of "+id+" from DataBase is:");
						try (Connection conn = db.getConnection();
					             PreparedStatement pstmt = conn.prepareStatement(sql);)
							{
							   pstmt.setInt(1, id);
								
								  try(ResultSet st=pstmt.executeQuery()) 
								  {
								 
									if(st.next())
									{
										int id1=st.getInt("id");
										String name=st.getString("name");
										int tamilmarks=st.getInt("tamilmarks");
										int englishmarks=st.getInt("englishmarks");
										int mathsmarks=st.getInt("mathsmarks");
										int sciencemarks=st.getInt("sciencemarks");
										int socialmarks=st.getInt("socialmarks");
										int average=st.getInt("average");
										int total=st.getInt("total");
										String classification=st.getString("classification");
										String eligibility=st.getString("eligibility");
										System.out.println(id1+" "+name+" "+tamilmarks+" "+englishmarks+" "+mathsmarks+" "+sciencemarks+" "+socialmarks+" "+average+" "+total+" "+classification+" "+eligibility);
							
					
									}
								  }
							}
							catch (SQLException e)
							{
					            e.printStackTrace();
							}
				
				}
			public void deletedetails(int id)
			{
				Databaseconnections db=new Databaseconnections();
				String sql="delete from studentinformation" +"where id=?";
				Databaseconnections db1=new Databaseconnections();
				System.out.println("connection established");
				try(Connection conn=db1.getConnection();PreparedStatement pstmt=conn.prepareStatement(sql);)
				{
					 	pstmt.setInt(1, id);
				        int rowsAffected = pstmt.executeUpdate();
				        if(rowsAffected>0)
				        {
				        	System.out.println("Record will be deleted for id:"+id);
				        }
				        else
				        {
				        	System.out.println("Record not found");
				        }
					
				}
				catch(SQLException e)
				{
					e.printStackTrace();
				}
			}
			
			
			public void marksupdation(int id)
			{
				Databaseconnections db=new Databaseconnections();
				
			}
	}			
		
